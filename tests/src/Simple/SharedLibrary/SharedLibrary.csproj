<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <OutputType>Library</OutputType>
    <IntermediateOutputPath>$(MSBuildProjectDirectory)\obj\$(Configuration)\$(Platform)\native\</IntermediateOutputPath>
    <NativeLib>Shared</NativeLib>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="*.cs" />
  </ItemGroup>

  <Target Name="NativeRunnerCompile" AfterTargets="LinkNative">
    <PropertyGroup>
      <NativeRunnerObject>$(NativeOutputPath)SharedLibrary</NativeRunnerObject>
    </PropertyGroup>

    <ItemGroup>
      <CppCompile Include="SharedLibrary.cpp" />
    </ItemGroup>

    <ItemGroup>
      <NativeRunnerCompilerArg Include="@(CppCompile)" />
      <NativeRunnerCompilerArg Include="-o $(NativeRunnerObject)" Condition="'$(OS)' != 'Windows_NT'" />
      <NativeRunnerCompilerArg Include="/Fo$(NativeRunnerObject)" Condition="'$(OS)' == 'Windows_NT'" />
      <NativeRunnerCompilerArg Include="/Fe$(NativeRunnerObject)" Condition="'$(OS)' == 'Windows_NT'" />
    </ItemGroup>

    <Exec Command="$(CppCompiler) @(NativeRunnerCompilerArg, ' ')" Condition="'$(OS)' != 'Windows_NT'" />
    <WriteLinesToFile File="$(IntermediateOutputPath)lib_native.rsp" Lines="@(NativeRunnerCompilerArg)" Overwrite="true"  Condition="'$(OS)' == 'Windows_NT'"/>
    <Exec Command="$(CppCompiler) @&quot;$(IntermediateOutputPath)lib_native.rsp&quot;" Condition="'$(OS)' == 'Windows_NT'" />
  </Target>

  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), SimpleTest.targets))\SimpleTest.targets" />

</Project>
